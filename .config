# ##############################################################################
# 极路由4（HC5962）OpenWrt 编译配置（支持DHCP拨号+外接存储+性能优化）
# 架构：ramips/mt7621 | 内核：5.15 | 闪存：128MB | 内存：256MB
# ##############################################################################

# 1. 目标设备与系统基础配置
CONFIG_TARGET_ramips=y
CONFIG_TARGET_ramips_mt7621=y
CONFIG_TARGET_ramips_mt7621_DEVICE_hiwifi_hc5962=y
CONFIG_TARGET_ROOTFS_SQUASHFS=y
CONFIG_TARGET_ROOTFS_PARTSIZE=64  # 根分区64MB，预留插件空间
CONFIG_TARGET_ROOTFS_INITRAMFS=n  # 禁用临时镜像，仅保留正式固件
CONFIG_HOST_OS_LINUX=y
CONFIG_HOST_ARCH_X86_64=y

# 2. 内核优化（性能+稳定性）
CONFIG_KERNEL_VERSION="5.15"
CONFIG_KERNEL_OPTIMIZE_FOR_SIZE=y
CONFIG_KERNEL_FLOW_OFFLOAD=y  # 硬件流转发（NAT加速核心）
CONFIG_KERNEL_FLOW_OFFLOAD_IPV6=y
CONFIG_KERNEL_SFE=y  # MT7621专属SFE加速
CONFIG_KERNEL_SFE_NAT=y  # SFE NAT转发加速（提升千兆转发速率）
CONFIG_KERNEL_NETFILTER_TPROXY=y  # 支持透明代理（兼容广告过滤/VPN）
CONFIG_KERNEL_CGROUP_CPUACCT=y  # 资源调度优化
CONFIG_KERNEL_CGROUP_DEVICE=y
CONFIG_KERNEL_CGROUP_FREEZER=y
CONFIG_KERNEL_CGROUP_SCHED=y
CONFIG_KERNEL_FAIR_GROUP_SCHED=y
CONFIG_KERNEL_CFS_BANDWIDTH=y

# 3. 网络组件（DHCP拨号+精简优化）
CONFIG_PACKAGE_dnsmasq_full=y  # 完整DNS缓存（支持广告过滤规则）
CONFIG_PACKAGE_dnsmasq_full_dnssec=y  # DNSSEC安全解析
CONFIG_PACKAGE_dnsmasq_full_auth=y
CONFIG_PACKAGE_dnsmasq_full_ipset=y
CONFIG_PACKAGE_firewall4=y  # 新一代防火墙（性能优于firewall3）
CONFIG_PACKAGE_nftables=y  # firewall4依赖
CONFIG_PACKAGE_ipset=y  # 规则匹配工具
CONFIG_PACKAGE_iptables-nft=y  # iptables兼容层
CONFIG_PACKAGE_libipset=y
CONFIG_PACKAGE_libnftnl=y
CONFIG_PACKAGE_resolvconf=y  # DNS解析配置
CONFIG_PACKAGE_dropbear=y  # SSH服务端（管理必备）
CONFIG_PACKAGE_dropbearconvert=y
CONFIG_PACKAGE_sshd-keygen=y

# 禁用无用网络组件（省资源）
CONFIG_PACKAGE_ip6tables=n
CONFIG_PACKAGE_odhcp6c=n
CONFIG_PACKAGE_odhcpd-ipv6only=n
CONFIG_PACKAGE_ppp=n  # 禁用PPPoE（DHCP拨号无需）
CONFIG_PACKAGE_ppp-mod-pppoe=n
CONFIG_PACKAGE_ppp-mod-pptp=n
CONFIG_PACKAGE_ppp-mod-l2tp=n

# 4. 外接存储完整支持（U盘/硬盘）
# USB驱动
CONFIG_PACKAGE_kmod-usb-core=y
CONFIG_PACKAGE_kmod-usb2=y  # 极路由4 USB2.0支持
CONFIG_PACKAGE_kmod-usb-storage=y  # USB存储核心驱动
CONFIG_PACKAGE_kmod-usb-storage-extras=y  # 额外存储设备兼容
CONFIG_PACKAGE_usbutils=y  # USB设备查询工具（lsusb）

# 文件系统驱动
CONFIG_PACKAGE_kmod-fs-ext4=y  # EXT4（推荐）
CONFIG_PACKAGE_kmod-fs-vfat=y  # FAT32
CONFIG_PACKAGE_kmod-fs-ntfs3=y  # NTFS3（原生驱动，性能优于ntfs-3g）
CONFIG_PACKAGE_ntfs-3g=y  # 备用NTFS支持（兼容旧设备）

# 存储管理工具
CONFIG_PACKAGE_blkid=y  # 分区识别
CONFIG_PACKAGE_e2fsprogs=y  # EXT4工具（格式化/修复）
CONFIG_PACKAGE_dosfstools=y  # FAT32工具
CONFIG_PACKAGE_block-mount=y  # 块设备挂载
CONFIG_PACKAGE_block-hotplug=y  # 热插拔支持（插U盘自动识别）
CONFIG_PACKAGE_luci-app-fstab=y  # LuCI挂载点界面（可视化配置）

# 字符编码（解决中文乱码）
CONFIG_PACKAGE_nls-cp437=y
CONFIG_PACKAGE_nls-utf8=y

# 5. 无线驱动（双频适配+优化）
CONFIG_PACKAGE_kmod-mt7603=y  # 2.4G驱动（MT7603E）
CONFIG_PACKAGE_kmod-mt7615=y  # 5G驱动（MT7615N）
CONFIG_PACKAGE_mt7603-firmware=y
CONFIG_PACKAGE_mt7615-firmware=y
CONFIG_PACKAGE_wpad-openssl=y  # 支持WPA3/WPA2-Enterprise
CONFIG_PACKAGE_hostapd-utils=y  # 无线调试工具
CONFIG_PACKAGE_iwinfo=y  # 无线状态查询（LuCI依赖）

# 6. LuCI Web管理界面（必备）
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-compat=y  # 兼容性插件（避免界面报错）
CONFIG_PACKAGE_luci-lib-ipkg=y
CONFIG_PACKAGE_luci-lib-jsonc=y
CONFIG_PACKAGE_luci-lib-nixio=y
CONFIG_PACKAGE_luci-mod-admin-full=y  # 完整管理功能
CONFIG_PACKAGE_luci-mod-network=y
CONFIG_PACKAGE_luci-mod-status=y
CONFIG_PACKAGE_luci-mod-system=y
CONFIG_PACKAGE_luci-theme-bootstrap=y  # 基础主题（省内存）
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y  # 中文语言包

# 7. 基础必备工具（不可删）
CONFIG_PACKAGE_curl=y  # 网络请求工具（插件依赖）
CONFIG_PACKAGE_iputils-ping=y  # ping排错
CONFIG_PACKAGE_iputils-traceroute=y  # 路由追踪
CONFIG_PACKAGE_libustream-openssl=y  # SSL库（HTTPS/插件依赖）
CONFIG_PACKAGE_opkg=y  # 包管理器
CONFIG_PACKAGE_procps-ng=y  # 进程管理
CONFIG_PACKAGE_procps-ng-pgrep=y
CONFIG_PACKAGE_procps-ng-pkill=y
CONFIG_PACKAGE_syslog-ng=y  # 日志工具（精简版）
CONFIG_PACKAGE_uci=y  # 配置管理
CONFIG_PACKAGE_wget-ssl=n  # 禁用wget-ssl，用curl替代

# 8. 精简无用组件（省内存/闪存）
CONFIG_PACKAGE_alsa-utils=n  # 音频（路由器无用）
CONFIG_PACKAGE_btrfs-progs=n  # BTRFS文件系统
CONFIG_PACKAGE_cifs-utils=n  # CIFS共享（不用可删）
CONFIG_PACKAGE_htop=n  # 进程监控（新手可删）
CONFIG_PACKAGE_lsblk=n  # 磁盘列表（block-mount已包含基础功能）
CONFIG_PACKAGE_openssh-client=n  # SSH客户端（路由器无用）
CONFIG_PACKAGE_samba4-server=n  # Samba共享（按需启用，默认禁用）
CONFIG_PACKAGE_tar=n  # 压缩工具
CONFIG_PACKAGE_unzip=n  # 解压工具（不用可删）
CONFIG_PACKAGE_zlib=n  # 部分插件已包含，系统层禁用

# 9. 编译选项优化
CONFIG_GCC_VERSION="12"  # 编译器版本
CONFIG_GCC_OPENMP=y  # 多线程编译优化
CONFIG_STRIP_KERNEL_EXPORTS=y  # 精简内核导出符号
CONFIG_STRIP_IGNORED_FILES=y  # 精简无用文件
CONFIG_USE_MKLIBS=y  # 优化库文件大小
CONFIG_COLLECT_KERNEL_DEBUG=y  # 保留基础调试信息（排错用）

# 10. 依赖与库文件（自动补全用，无需修改）
CONFIG_PACKAGE_libc=y
CONFIG_PACKAGE_libgcc=y
CONFIG_PACKAGE_libpthread=y
CONFIG_PACKAGE_librt=y
CONFIG_PACKAGE_libstdcpp=y
CONFIG_PACKAGE_zlib=y

# ##############################################################################
# 可选功能（按需取消注释启用）
# ##############################################################################
# 1. Samba共享（网络访问外接存储）
# CONFIG_PACKAGE_samba4-server=y
# CONFIG_PACKAGE_luci-app-samba4=y
# CONFIG_PACKAGE_luci-i18n-samba4-zh-cn=y

# 2. 广告过滤（AdGuardHome）
# CONFIG_PACKAGE_luci-app-adguardhome=y
# CONFIG_PACKAGE_adguardhome=y

# 3. 主题美化（Argon主题，需先将主题源码放入package/目录）
CONFIG_PACKAGE_luci-theme-argon=y
